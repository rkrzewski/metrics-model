# Scala model of Dropwizard Metrics

The purpose of this project is to provide a model of [Dropwizard Metrics](https://github.com/dropwizard/metrics)
as a family of Scala case classes a facility for decoding JSON representation
of those, generated by [`metrics-json` module](https://github.com/dropwizard/metrics/tree/3.2-development/metrics-json)
and another facility for encoding their contents into [InfluxDB](https://docs.influxdata.com/influxdb/v0.13/) [line protocol](https://docs.influxdata.com/influxdb/v0.13/)

## Tools used

* [Circe](https://github.com/travisbrown/circe) for JSON parsing
* [Shapeless](https://github.com/milessabin/shapeless) for conversion to line protocol
* [ScalaTest](http://www.scalatest.org/) for running tests

## Help wanted!

I was trying to follow ["minimal JSON writer"](http://kanaka.io/blog/2015/11/10/shapeless-not-a-tutorial-part-2.html#section_4)
example from Valentin Kasas' blog when implementing my converter to line protocol,
but this is my first attempt at using Shapeless and I'm having much trouble with
it. I managed to get the code of the converter to compile, but it when I'm
attempting to use it, compiler complains about multiple missing implicits.
Unfortunately, after spending many hours reading Shapeless Wiki, StackOverflow
and Shapeless sources I'm still unable to determine if the failing code contains
a trivial mistake, or if it's nonsensical wishful thinking, and a completely
different abstractions need to be used.

## Caveats

In Dropwizard Metrics, the most general metric type, `Gauge` is parametric in
the type of it's value. This means that JSON representation of it provided by
`metrics-json` may contain arbitrary JSON data. Since the intended target of
the data is InfluxDB, only a limited set of gauge data types is sensible. At
this point, JSON parser supports only numeric (arbitrary precision) gauges,
and gauges that contain (possibly empty) list of strings. This second type
is used by [`metrics-jvm` module](https://github.com/dropwizard/metrics/tree/3.2-development/metrics-jvm) to report thread deadlocks.
